/*************************
 * Heriland – 徽章 (Badges)
 * scope: #badges only
 *************************/

/* ===== Theme tokens ===== */
#badges{
  --bg: #0f1113;
  --text: #e9edf1;
  --sub: #c3cbd2;
  --muted: #9fb0bd;

  --glass: rgba(255,255,255,.06);
  --glass-strong: rgba(255,255,255,.08);
  --border: rgba(255,255,255,.14);

  /* 金屬色 */
  --gold-1: #f6c350; --gold-2: #ffd986; --gold-3: #9a6b1f;
  --silver-1: #e5e8ec; --silver-2: #cfd6de; --silver-3: #8a949e;
  --gray-1: rgba(255,255,255,.35); --gray-2: rgba(255,255,255,.15);

  /* 城市/體驗主題色（可依資料擴充） */
  --kuching: #1e6b5b;     /* 古晉 森林綠 */
  --sibu:    #2a7ea8;     /* 詩巫 湖水藍 */
  --miri:    #3a6dde;     /* 美里 海天藍 */
  --food:    #ff8a3d;     /* 美食 橘 */
  --culture: #8c6ad6;     /* 文化 紫 */
  --nature:  #3aa676;     /* 自然 綠 */
  --milestone: #c9d1d9;   /* 里程碑 銀灰 */
  --specialA: #ff7eb3;    /* 特殊 彩虹 */
  --specialB: #65c7f7;

  --badge-size: 88px;     /* 手機視覺尺寸；桌面會放大 */
}

/* Page base */
#badges.vip-view{ background: var(--bg); color: var(--text); }
#badges .content{ padding: 14px 16px 18px; }

/* Header（沿用你的整體風格，稍作拋光） */
#badges .sub-header{
  position: sticky; top:0; z-index: 20;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:12px 16px;
  background: linear-gradient(180deg, rgba(15,17,19,.92), rgba(15,17,19,.5));
  border-bottom:1px solid var(--border);
  backdrop-filter: blur(10px);
}
#badges .sub-header h3{ margin:0; font-size:18px; font-weight:900; letter-spacing:.2px; }
#badges .sub-header .left button,
#badges .sub-header .right button{
  padding:8px 14px; border-radius:999px; border:1px solid var(--border);
  background: rgba(255,255,255,.08); color: var(--text);
}

/* 頂部 Tabs（簡約，保持一致風格） */
#badges .badge-tabs{
  display:flex; gap:8px; flex-wrap:wrap; margin: 6px 0 12px;
}
#badges .badge-tabs .tab{
  padding: 8px 14px; border-radius: 999px;
  background: var(--glass); border:1px solid var(--border); color:var(--text);
  font-weight:700;
}
#badges .badge-tabs .tab[aria-selected="true"]{
  box-shadow: 0 0 0 3px rgba(246,195,80,.18);
  border-color: var(--gold-1);
}

/* 面板抬頭 + 進度條 */
#badges .panel-head{
  display:flex; align-items:center; justify-content:space-between; gap:10px; margin: 6px 0 10px;
}
#badges .panel-head h4{ margin:0; font-size:18px; font-weight:900; }
#badges .panel-head .progress{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px; border-radius:999px;
  background: var(--glass); border:1px solid var(--border); color: var(--text);
}

/* ===== 4 欄徽章網格 ===== */
#badges .badge-grid{
  list-style:none; margin:0; padding:0;
  display:grid; gap:14px;
  grid-template-columns: repeat(4, minmax(0,1fr));
}
@media (min-width: 720px){
  #badges{ --badge-size: 98px; }
}
@media (min-width: 1024px){
  #badges{ --badge-size: 112px; }
}

/* ===== 徽章卡（圓形 + 金屬邊框 + 玻璃底） ===== */
#badges .badge-item{ display:flex; justify-content:center; }
#badges .badge-card{
  width: calc(var(--badge-size) + 8px);
  aspect-ratio: 1 / 1;
  border: none; background: transparent; padding:0;
  position:relative; cursor:pointer;
  display:grid; place-items:center; gap:6px;
  color: var(--text);
  transition: transform .12s ease, filter .12s ease;
  will-change: transform;
}
#badges .badge-card:active{ transform: scale(.96); }

/* 金屬外圈（用 ::before 畫雙層金屬環） */
#badges .badge-card::before{
  content:""; position:absolute; inset:0;
  border-radius:50%;
  background:
    conic-gradient(from 0deg,
      rgba(255,255,255,.85), rgba(255,255,255,.35) 18%, rgba(0,0,0,.18) 32%,
      rgba(255,255,255,.55) 48%, rgba(0,0,0,.22) 64%, rgba(255,255,255,.65) 82%, rgba(0,0,0,.18) 100%);
  mask:
    radial-gradient(circle at 50% 50%, transparent calc(50% - 10px), #000 calc(50% - 9px));
  box-shadow: 0 6px 16px rgba(0,0,0,.35);
  opacity:.9;
}

/* 內圈玻璃台座（::after） */
#badges .badge-card::after{
  content:""; position:absolute; inset:8px;
  border-radius:50%;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
  border: 1px solid var(--border);
  box-shadow: inset 0 12px 28px rgba(0,0,0,.35), inset 0 -10px 20px rgba(255,255,255,.05);
}

/* 金邊/銀邊（依解鎖等級覆蓋外圈色澤） */
#badges .badge-card[data-tier="gold"]::before{
  background: conic-gradient(from 0deg, var(--gold-2), var(--gold-1) 22%, var(--gold-3) 38%, var(--gold-2) 58%, var(--gold-1) 78%, var(--gold-3) 100%);
}
#badges .badge-card[data-tier="silver"]::before{
  background: conic-gradient(from 0deg, var(--silver-1), var(--silver-2) 25%, var(--silver-3) 50%, var(--silver-2) 75%, var(--silver-1) 100%);
}

/* 徽章圖示（圓內主視覺） */
#badges .badge-icon{
  position:relative; z-index:2;
  width: var(--badge-size); height: var(--badge-size);
  border-radius:50%;
  display:grid; place-items:center; overflow:hidden;
  background: radial-gradient(120% 120% at 50% 0%, rgba(255,255,255,.18), rgba(255,255,255,.04) 50%, rgba(0,0,0,.22));
}
#badges .badge-icon img{
  width:70%; height:70%; object-fit:contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
}

/* 名稱 */
#badges .badge-name{
  position:absolute; bottom:-2px; left:50%; transform:translateX(-50%);
  white-space:nowrap; font-size:12px; font-weight:700; color:var(--text);
  background: rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.22);
  padding: 3px 8px; border-radius: 999px;
  backdrop-filter: blur(6px);
}

/* ===== 已解鎖 / 未解鎖 狀態 ===== */
/* 允許兩種掛法：.badge-card[data-unlocked="false"] 或 :has(.badge-state[data-unlocked="false"]) */
#badges .badge-card[data-unlocked="false"],
#badges .badge-card:has(.badge-state[data-unlocked="false"]){
  filter: grayscale(.9) brightness(.8);
}
#badges .badge-card[data-unlocked="false"] .lock,
#badges .badge-card:has(.badge-state[data-unlocked="false"]) .lock{
  position:absolute; z-index:3; top:8px; right:8px; font-size:16px; opacity:.9;
}

/* 解鎖日期（已解鎖時顯示，JS 可移除 hidden） */
#badges .badge-state .date{
  position:absolute; z-index:3; bottom:8px; right:8px;
  background: rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18);
  padding: 2px 6px; border-radius: 8px; font-size:11px; color:#fff;
}

/* ===== 類型色系（圖像內緣暈光） ===== */
/* 依資料在 .badge-card 上帶 data-category / data-theme */
#badges .badge-card[data-category="city"][data-theme="kuching"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(30,107,91,.45), 0 0 24px rgba(30,107,91,.35);
}
#badges .badge-card[data-category="city"][data-theme="sibu"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(42,126,168,.45), 0 0 24px rgba(42,126,168,.35);
}
#badges .badge-card[data-category="city"][data-theme="miri"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(58,109,222,.45), 0 0 24px rgba(58,109,222,.35);
}
#badges .badge-card[data-category="exp"][data-theme="food"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(255,138,61,.45), 0 0 24px rgba(255,138,61,.35);
}
#badges .badge-card[data-category="exp"][data-theme="culture"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(140,106,214,.45), 0 0 24px rgba(140,106,214,.35);
}
#badges .badge-card[data-category="exp"][data-theme="nature"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(58,166,118,.45), 0 0 24px rgba(58,166,118,.35);
}
#badges .badge-card[data-category="milestone"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(201,209,217,.45), 0 0 24px rgba(201,209,217,.35);
}
#badges .badge-card[data-category="special"] .badge-icon{
  box-shadow: inset 0 0 0 2px rgba(255,126,179,.45), 0 0 0 6px rgba(101,199,247,.25),
              0 0 28px rgba(255,126,179,.28), inset 0 0 24px rgba(101,199,247,.22);
}

/* ===== 解鎖動畫（由灰 → 彩 + 星星閃爍） ===== */
/* 將 .badge-card 加上 .unlocked-anim（或 data-unlocked 从 false → true 時同時加上這個 class） */
#badges .badge-card.unlocked-anim{
  animation: badge-pop .28s ease-out both;
}
@keyframes badge-pop{
  0%{ transform: scale(.9); filter: grayscale(.9) brightness(.85); }
  60%{ transform: scale(1.08); filter: none; }
  100%{ transform: scale(1); }
}
/* 星星火花 */
#badges .badge-card.unlocked-anim .badge-icon::after{
  content:""; position:absolute; inset:-8%; border-radius:50%;
  background:
    radial-gradient(circle at 20% 30%, rgba(255,255,255,.75) 0, rgba(255,255,255,.0) 24%),
    radial-gradient(circle at 70% 20%, rgba(255,255,255,.85) 0, rgba(255,255,255,.0) 20%),
    radial-gradient(circle at 80% 70%, rgba(255,255,255,.65) 0, rgba(255,255,255,.0) 22%),
    radial-gradient(circle at 30% 80%, rgba(255,255,255,.75) 0, rgba(255,255,255,.0) 20%);
  animation: twinkle .6s ease-out both;
}
@keyframes twinkle{
  from{ opacity:0; transform: scale(.8) rotate(-8deg); }
  60%{ opacity:1; transform: scale(1.06) rotate(6deg); }
  to{ opacity:0; transform: scale(1) rotate(0deg); }
}

/* ===== 滾動微縮放（翻看收藏冊的感覺） ===== */
#badges .badge-grid{ transform: translateZ(0); }
#badges .badge-card{ transition: transform .16s ease, filter .16s ease, box-shadow .16s ease; }
#badges .badge-card:hover{ transform: translateY(-2px) scale(1.02); } /* 桌面可感 */
@media (max-width: 428px){
  /* 行動裝置：不做 hover，保留點按回饋 */
}

/* 空狀態 */
#badges .empty-state{
  margin-top: 12px; text-align:center; padding: 24px 16px;
  background: var(--glass); border:1px dashed var(--border); border-radius:16px; color: var(--sub);
}
#badges .empty-state .illus{ font-size: 44px; opacity:.8; }
#badges .empty-state h4{ margin:6px 0 4px; font-weight:900; color:var(--text); }

/* ===== 詳情彈窗（沿用全站 sheet，但稍微拋光） ===== */
#badges .sheet{
  background: linear-gradient(180deg, rgba(22,24,27,.95), rgba(22,24,27,.98));
  border-top:1px solid var(--border);
  border-radius:16px 16px 0 0;
}
#badges .sheet-hero{
  display:grid; place-items:center;
  background: radial-gradient(120% 170% at 50% -40%, rgba(255,255,255,.18), rgba(255,255,255,.02) 60%, rgba(0,0,0,.35));
  border:1px solid var(--border); border-radius:16px; padding:18px; margin-bottom:10px;
}
#badges #badgeHero{ width: 120px; height: 120px; object-fit:contain; filter: drop-shadow(0 4px 14px rgba(0,0,0,.45)); }
#badges .badge-meta .row{ display:flex; gap:10px; padding:6px 0; }
#badges .badge-meta dt{ width:90px; color:var(--sub); }
#badges .badge-meta dd{ margin:0; color:var(--text); }

/* ===== 可讀性與安全 ===== */
#badges, #badges *{ box-sizing:border-box; max-width:100%; }
#badges img{ max-width:100%; height:auto; display:block; }